data:text/html,
<title>Nimbus Web | v1.0.2</title>

<style>
    .l {
        position: fixed;
        left: 0;
        top: 40px;
        width: 30px;
        height: calc(100% - 40px);
        background-color: rgb(40, 44, 52);
        color: white;
        text-align: center;
        font-size: 14px;
        padding-top: 5px;
        box-sizing: border-box;
        line-height: 1em;
        overflow-y: scroll;
        cursor: default;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        border-right: 1px solid lightgray;
        text-wrap: wrap;
        padding-bottom: 8px;
    }

    .l::-webkit-scrollbar {
        display: none;
    }


    .c {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        width: calc(100% - 30px);
        height: calc(100% - 40px);
        position: fixed;
        left: 30px;
        top: 40px;
        outline: 0;
        font-size: 14px;
        padding-top: 4.5px;
        box-sizing: border-box;
        line-height: 1em;
        background-color: transparent;
        color: transparent;
        border: none;
        padding-left: 5px;
        z-index: 3;
        caret-color: lightgray;
        padding-bottom: 8px;
        box-sizing: border-box;
        text-wrap: wrap;
    }

    .c::selection {
        background-color: rgb(211, 211, 211, 0.35);
    }

    .h {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        width: calc(100% - 30px);
        height: calc(100% - 40px);
        position: fixed;
        left: 30px;
        top: 40px;
        outline: 0;
        font-size: 14px;
        padding-top: 4.5px;
        box-sizing: border-box;
        line-height: 1em;
        background-color: rgb(40, 44, 52);
        color: lightgray;
        border: none;
        padding-left: 5px;
        z-index: 2;
        overflow-y: scroll;
        padding-bottom: 8px;
        box-sizing: border-box;
        text-wrap: wrap;
    }

    .cm {
        position: fixed;
        z-index: 4;
        background-color: black;
        color: white;
        top: 100px;
        left: 100px;
        width: 200px;
        height: 30px;
        display: none;
        justify-content: center;
    }

    .cm>div {
        display: flex;
        cursor: pointer;
        text-align: center;
        justify-content: center;
        width: 100%;
        align-items: center;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        font-size: 14px;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .cm>div:hover {
        background-color: rgb(47, 114, 229);
    }

    .t {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 40px;
        background-color: rgb(40, 44, 52);
        border-bottom: 1px solid lightgray;
        z-index: 4;
    }

    .tab {
        height: 100%;
        float: left;
        display: flex;
        align-items: center;
        width: fit-content;
        padding-left: 10px;
        padding-right: 10px;
        border-right: 1px solid lightgray;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        font-size: 14px;
        cursor: pointer;
        color: lightgray;
        opacity: 0.7;
    }

    .tab.selected {
        opacity: 1 !important;
    }

    .tc {
        margin-left: 5px;
        font-size: 16px;
        color: lightgray;
        transition: .25s;
    }

    .tc:hover {
        color: red;
    }

    .isp {
        position: fixed;
        top: 15px;
        right: 15px;
        width: 250px;
        height: 150px;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        background-color: rgb(43, 48, 58);
        z-index: 11;
        color: white;
        box-shadow: 0 3px 10px rgb(0 0 0 / 0.2);
        padding-left: 15px;
        box-sizing: border-box;
    }

    .isp-de {
        font-size: 12px;
        margin-top: -10px;
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/a-riceeater/DataCodeEditor@latest/atom.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify.js"></script>

<div class="t">
    <div class="tab selected">
        <span class="tn">Nimbus Web</span>
    </div>
</div>
<div class="l"></div>
<pre>
        <div class="h"></div>
</pre>
<textarea class="c" autofocus spellcheck="false" autocomplete="off" autocapitalize="false"></textarea>
<div class="cm">
    <div class="fm">Format Document</div>
</div>
<div class="isp">
    <p>Intelliscense</p>
    <p class="isp-de">Press tab to accept</p>
    <p class="isp-sug"></p>
</div>
<!-- Intelliscense, won't include in main but different file? -->

<script>
    var intSug;
    const suggestions = [
        {
            s: "addEventListener",
            u: 0
        },
        {
            s: "alert",
            u: 0
        },
        {
            s: "Audio",
            u: 0
        },
        {
            s: "AbortController",
            u: 0
        },
        {
            s: "Array",
            u: 0
        },
        {
            s: "Buffer",
            u: 0
        },
        {
            s: "Blob",
            u: 0
        },
        {
            s: "Boolean",
            u: 0
        },
        {
            s: "BroadcastChannel",
            u: 0
        },
        {
            s: "console",
            u: 0
        },
        {
            s: "CSSAnimation",
            u: 0
        },
        {
            s: "DOMException",
            u: 0
        },
        {
            s: "document",
            u: 0
        },
        {
            s: "Document",
            u: 0
        },
        {
            s: "Date",
            u: 0
        },
        {
            s: "Error",
            u: 0
        },
        {
            s: "fetch",
            u: 0
        },
        {
            s: "Generator",
            u: 0
        },
        {
            s: "history",
            u: 0
        },
        {
            s: "Image",
            u: 0
        },
        {
            s: "JSON",
            u: 0
        },
        {
            s: "KeyboardEvent",
            u: 0
        },
        {
            s: "localStorage",
            u: 0
        },
        {
            s: "let",
            u: 0
        },
        {
            s: "location",
            u: 0
        },
        {
            s: "length",
            u: 0
        },

        {
            s: "Math",
            u: 0
        },
        {
            s: "Number",
            u: 0
        },
        {
            s: "Object",
            u: 0
        },
        {
            s: "Promise",
            u: 0
        },
        {
            s: "RegExp",
            u: 0
        },
        {
            s: "Set",
            u: 0
        },
        {
            s: "Text",
            u: 0
        },
        {
            s: "URL",
            u: 0
        },
        {
            s: "Video",
            u: 0
        },
        {
            s: "Window",
            u: 0
        },
        {
            s: "WebSocket",
            u: 0
        },
        {
            s: "XMLHttpRequest",
            u: 0
        }
    ];

    const insertAt = (original, toInsert, index) => original.slice(0, index) + toInsert + original.slice(index);
    const getLargest = r => r.reduce((t, e, n) => e >= r[t] ? n : t, 0);
    var currentWord = "";

    try {
        function is(k) {
            const st = setTimeout;
            var lc = e.value.charAt(e.selectionStart - 2);
            var t = e.value;
            var sp = e.selectionStart;

            let start = t.lastIndexOf(' ', sp - 1) + 1;
            let end = t.indexOf(' ', sp);

            if (end === -1) {
                end = t.length;
            }

            const word = t.substring(start, end);
            switch (k) {
                case "Enter":
                    if (lc == "{") {
                        ins("\n")
                        ins("    ")
                    }
                    if (lc == ":" && lang == "py" || lang == "python") {
                        ins("    ")
                    }
                    break
            }

            const sug = suggestions.find(s => s.s.toLowerCase().startsWith(word.toLowerCase()));
             if (sug) {
                 console.log(sug)
                 document.querySelector(".isp-sug").innerHTML = `<b>${word}</b>` + sug.s.replace(word, "");
             } else document.querySelector(".isp-sug").innerHTML = "";

             


            var sugs = [];
            var inx = [];
            let top = [];
            /*for (let i = 0; i < suggestions.length; i++) {
                if (suggestions[i].s.toLocaleLowerCase().startsWith(word.toLowerCase())) {
                    sugs.push(suggestions[i])
                }
            }
            
            for (let i = 0; i < sugs.length; i++) {
                
            }*/

            intSug = "" //.replace(word, "")
            hl();

        }
    } catch (er) {
        alert(er)
    }

    function getCursorPos(input) {
    if ("selectionStart" in input && document.activeElement == input) {
        return {
            start: input.selectionStart,
            end: input.selectionEnd
        };
    }
    else if (input.createTextRange) {
        var sel = document.selection.createRange();
        if (sel.parentElement() === input) {
            var rng = input.createTextRange();
            rng.moveToBookmark(sel.getBookmark());
            for (var len = 0;
                     rng.compareEndPoints("EndToStart", rng) > 0;
                     rng.moveEnd("character", -1)) {
                len++;
            }
            rng.setEndPoint("StartToStart", input.createTextRange());
            for (var pos = { start: 0, end: len };
                     rng.compareEndPoints("EndToStart", rng) > 0;
                     rng.moveEnd("character", -1)) {
                pos.start++;
                pos.end++;
            }
            return pos;
        }
    }
    return -1;
}
</script>
<script>
    const d = (q) => document.querySelector(q)
    var lang = "js"//prompt('What language are you coding in?').trim()
    var cf = ""
    var files = {}
    var h = d(".h")
    var e = d(".c")
    var l = d(".l")
    var cm = d(".cm")
    var wl
    var cfh;

    navigator.platform.toString().toLowerCase().includes('mac') ? e.placeholder = '⌘+S: OPEN PAGE OUTPUT | ⌘+D: SAVE AS FILE' : e.placeholder = 'CTRL+S: OPEN PAGE OUTPUT | CTRL+D: SAVE AS FILE'

    async function gf() {
        try {
            const [fh] = await window.showOpenFilePicker({
                types: [
                    {
                        description: "Text files",
                        accept: {
                            "text/*": ".txt"
                        }
                    }
                ],
                multiple: false,
                excludeAcceptAllOption: true,
            });
            cfh = fh;
            return await fh.getFile()
        } catch (err) {
            console.error(err)
            if (!err.toString().includes("aborted")) alert("User must do an input (keypress/click) before opening dialog, or File API not supported.")
        }
    }

    e.addEventListener("scroll", (a) => {
        const st = a.target.scrollTop
        h.scrollTop = st
        l.scrollTop = st
        h.scrollLeft = a.target.scrollLeft
    })

    l.addEventListener("scroll", (a) => {
        const st = a.target.scrollTop
        h.scrollTop = st
        e.scrollTop = st
    })

    const ins = (ch, ev) => {
        const sp = e.selectionStart
        const ep = e.selectionEnd

        if (e.value.charAt(sp) == ch) {
            e.setSelectionRange(sp + 1, sp + 1)
            ev.preventDefault()
            return
        }

        e.value = e.value.substring(0, sp) + ch + e.value.substring(ep)
        e.selectionStart = e.selectionEnd = sp + ch.length - 1
        e.focus()
    }

    const inb = (ch, a) => {
        var sp = e.selectionStart;
        if (e.value.charAt(sp) != ch) return
        e.setSelectionRange(sp + 1, sp + 1);
        a.preventDefault()
    }

    const hl = () => {
        var rs;
        if (intSug) {
            rs = insertAt(e.value, "suggestion", e.selectionStart)
        }
        h.innerHTML = hljs.highlight(rs || e.value, { language: lang }).value || (rs || e.value)
    }

    const fd = () => {
        try {
            e.value = js_beautify(e.value, { indent_size: 4 })
            hl()
            cm.style.display = "none"
        } catch (err) {
            alert("Failed to format...")
            console.error(err)
        }
    }

    e.addEventListener("keydown", async (a) => {
        if (a.key == "Tab") a.preventDefault()
        hl()

        if (a.key == " " || a.key == "Enter") currentWord = "";
        else if (a.key.toString().length == 1) currentWord += a.key

        try {
            if (a.ctrlKey && a.key == "d" || a.metaKey && a.key == "d") {
                a.preventDefault();
                const ae = document.createElement("a")
                var fn = prompt("file name? (with ext.)")
                if (!fn) return
                ae.download = fn
                ae.href = URL.createObjectURL(new Blob([e.value], { type: 'text/plain' }))
                ae.click()
            }
            else if (a.ctrlKey && a.key == "s" || a.metaKey && a.key == "s") {
                a.preventDefault()
                if (cfh) {
                    console.log(cfh)
                    var w = await cfh.createWritable()
                    await w.write(new Blob([e.value], { type: 'text/plain' }))
                    await w.close()
                    files[cf] = e.value;
                } else {
                    if (wl) wl.close()
                    const w = window.open()
                    w.document.write(e.value)
                    wl = w
                }
            }
            else if (a.ctrlKey && a.key == "p" || a.metaKey && a.key == "p") {
                a.preventDefault()
                fd()
            }
            else if (a.ctrlKey && a.key == "o" || a.metaKey && a.key == "o") {
                try {
                a.preventDefault()
                const f = await gf()
                if (!f) return
                lang = /(?:\.([^.]+))?$/.exec(f.name)[1];
                var text = await f.text()
                e.value = text
                files[f.name] = text
                cf = fd.name;
                setTimeout(hl);
                document.title = `${f.name} - Nimbus Web`

                document.querySelectorAll(".selected").forEach(el => el.classList.remove("selected"))

                const tab = document.createElement("div")
                tab.classList.add("tab")
                tab.classList.add("selected")
                tab.innerHTML = `
                <span class="tn">${f.name}</span>
                <span class="tc">x</span>
                `
                d(".t").appendChild(tab)

                tab.addEventListener("click", async (ev) => {
                    var fn = tab.innerText;
                    lang = /(?:\.([^.]+))?$/.exec(f.name)[1];
                    e.value = files[f.name]
                    cf = f.name;
                    setTimeout(hl);
                    document.title = `${f.name} - Nimbus Web`
                    document.querySelectorAll(".selected").forEach(el => el.classList.remove("selected"))
                    tab.classList.add("selected")
                })
            } catch (err) { alert(err) }
            }
        } catch (err) { alert(err) }

        switch (a.key) {
            case "Tab":
                ins('    ')
                break
            case "{":
                ins("}", a)
                break
            case "[":
                ins("]", a)
                break
            case "(":
                ins(")", a)
                break
            case "\"":
                ins("\"", a)
                break
            case "\'":
                ins("\'", a)
                break
            case "\`":
                ins("\`", a)
            case ")":
                inb(")", a)
                break
            case "}":
                inb("}", a)
                break
            case "]":
                inb("]", a)
                break/*
            case "Backspace":
                console.log(e.value.charAt(e.selectionStart))
                if (e.value.charAt(e.selectionStart - 1) == "{") {
                    setTimeout(() => e.value = e.value.replaceAt(0, ""))
                }*/
        }
        setTimeout(() => {
            is(a.key)

            setTimeout(() => {

                hl()
                const st = e.scrollTop
                l.scrollTop = st
                h.scrollTop = st
                h.scrollLeft = e.scrollLeft

                let ld = ""
                let ln = e.value.split("\n").length
                for (let i = 0; i < ln; i++) { ld += `${i + 1}<br>` }
                l.innerHTML = ld
            })

        })
    })
    e.addEventListener("contextmenu", (ev) => {
        ev.preventDefault();
        cm.style.top = ev.clientY;
        cm.style.left = ev.clientX;
        cm.style.display = "flex"
    })

    e.addEventListener("click", (ev) => {
        cm.style.display = "none"
    })

    d(".fm").addEventListener("click", fd)
    String.prototype.replaceAt = function (index, replacement) {
        return this.substring(0, index) + replacement + this.substring(index + replacement.length);
    }
</script>
