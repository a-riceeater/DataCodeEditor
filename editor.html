data:text/html,
<title>Nimbus Web | v1.0.1</title>

<style>
    .l {
        position: fixed;
        left: 0;
        top: 0;
        width: 30px;
        height: 100%;
        background-color: rgb(40, 44, 52);
        color: white;
        text-align: center;
        font-size: 14px;
        padding-top: 5px;
        box-sizing: border-box;
        line-height: 1em;
        overflow-y: scroll;
        cursor: default;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        border-right: 1px solid lightgray;
        text-wrap: wrap;   
    }

    .l::-webkit-scrollbar {
        display: none;
    }


    .c {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        width: calc(100% - 30px);
        height: 100%;
        position: fixed;
        left: 30px;
        top: 0;
        outline: 0;
        font-size: 14px;
        padding-top: 2.5px;
        box-sizing: border-box;
        line-height: 1em;
        background-color: transparent;
        color: transparent;
        border: none;
        padding-left: 5px;
        z-index: 3;
        caret-color: lightgray;
        padding-bottom: 8px;
        box-sizing: border-box;
        text-wrap: wrap;    
    }

    .c::selection {
        background-color: rgb(211, 211, 211, 0.35);
    }

    .h {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        width: calc(100% - 30px);
        height: 100%;
        position: fixed;
        left: 30px;
        top: -0;
        outline: 0;
        font-size: 14px;
        padding-top: 2.5px;
        box-sizing: border-box;
        line-height: 1em;
        background-color: rgb(40, 44, 52);
        color: lightgray;
        border: none;
        padding-left: 5px;
        z-index: 2;
        overflow-y: scroll;
        padding-bottom: 8px;
        box-sizing: border-box;
        text-wrap: wrap;
    }

    .cm {
        position: fixed;
        z-index: 4;
        background-color: black;
        color: white;
        top: 100px;
        left: 100px;
        width: 200px;
        height: 30px;
        display: none;
        justify-content: center;
    }

    .cm>div {
        display: flex;
        cursor: pointer;
        text-align: center;
        justify-content: center;
        width: 100%;
        align-items: center;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        font-size: 14px;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .cm>div:hover {
        background-color: rgb(47, 114, 229);
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/a-riceeater/DataCodeEditor@latest/atom.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify.js"></script>

<div class="l"></div>
<pre>
        <div class="h"></div>
    </pre>
<textarea class="c" autofocus spellcheck="false" autocomplete="off" autocapitalize="false"></textarea>
<div class="cm">
    <div class="fm">Format Document</div>
</div>
<!-- Intelliscense, won't include in main but different file? -->

<script>
    var intSug;
    const suggestions = [
        {
            s: "addEventListener",
            u: 0
        },
        {
            s: "alert",
            u: 0
        },
        {
            s: "Audio",
            u: 0
        },
        {
            s: "AbortController",
            u: 0
        },
        {
            s: "Array",
            u: 0
        },
        {
            s: "Buffer",
            u: 0
        },
        {
            s: "Blob",
            u: 0
        },
        {
            s: "Boolean",
            u: 0
        },
        {
            s: "BroadcastChannel",
            u: 0
        },
        {
            s: "console",
            u: 0
        },
        {
            s: "CSSAnimation",
            u: 0
        },
        {
            s: "DOMException",
            u: 0
        },
        {
            s: "document",
            u: 0
        },
        {
            s: "Document",
            u: 0
        },
        {
            s: "Date",
            u: 0
        },
        {
            s: "Error",
            u: 0
        },
        {
            s: "fetch",
            u: 0
        },
        {
            s: "Generator",
            u: 0
        },
        {
            s: "history",
            u: 0
        },
        {
            s: "Image",
            u: 0
        },
        {
            s: "JSON",
            u: 0
        },
        {
            s: "KeyboardEvent",
            u: 0
        },
        {
            s: "localStorage",
            u: 0
        },
        {
            s: "let",
            u: 0
        },
        {
            s: "location",
            u: 0
        },
        {
            s: "length",
            u: 0
        },

        {
            s: "Math",
            u: 0
        },
        {
            s: "Number",
            u: 0
        },
        {
            s: "Object",
            u: 0
        },
        {
            s: "Promise",
            u: 0
        },
        {
            s: "RegExp",
            u: 0
        },
        {
            s: "Set",
            u: 0
        },
        {
            s: "Text",
            u: 0
        },
        {
            s: "URL",
            u: 0
        },
        {
            s: "Video",
            u: 0
        },
        {
            s: "Window",
            u: 0
        },
        {
            s: "WebSocket",
            u: 0
        },
        {
            s: "XMLHttpRequest",
            u: 0
        }
    ];

    const insertAt = (original, toInsert, index) => original.slice(0, index) + toInsert + original.slice(index);
    //function getLargest(r){for(var t,e=r[0],n=0;n<r.length;n++)e<=r[n]&&(e=r[n],t=n);return t}
    const getLargest = r => r.reduce((t, e, n) => e >= r[t] ? n : t, 0);

    try {
        function is(k) {
            const st = setTimeout;
            var lc = e.value.charAt(e.selectionStart - 2);
            var t = e.value;
            var sp = e.selectionStart;

            let start = t.lastIndexOf(' ', sp - 1) + 1;
            let end = t.indexOf(' ', sp);

            if (end === -1) {
                end = t.length;
            }

            const word = t.substring(start, end);
            switch (k) {
                case "Enter":
                    if (lc == "{") {
                        ins("\n")
                        ins("    ")
                    }
                    if (lc == ":" && lang == "py" || lang == "python") {
                        ins("    ")
                    }
                    break
            }

            /* const sug = suggestions.find(s => s.s.toLowerCase().startsWith(word.toLowerCase()));
             if (sug) {
                 console.log(sug)
             }*/

            var sugs = [];
            var inx = [];
            let top = [];
            /*for (let i = 0; i < suggestions.length; i++) {
                if (suggestions[i].s.toLocaleLowerCase().startsWith(word.toLowerCase())) {
                    sugs.push(suggestions[i])
                }
            }
            
            for (let i = 0; i < sugs.length; i++) {
                
            }*/

            intSug = "" //.replace(word, "")
            hl();

        }
    } catch (er) {
        alert(er)
    }
</script>
<script>
    const d = (q) => document.querySelector(q)
    var lang = "js"//prompt('What language are you coding in?').trim()
    var h = d(".h")
    var e = d(".c")
    var l = d(".l")
    var cm = d(".cm")
    var wl
    var cfh;

    navigator.platform.toString().toLowerCase().includes('mac') ? e.placeholder = '⌘+S: OPEN PAGE OUTPUT | ⌘+D: SAVE AS FILE' : e.placeholder = 'CTRL+S: OPEN PAGE OUTPUT | CTRL+D: SAVE AS FILE'

    async function gf() {
        try {
            const [fh] = await window.showOpenFilePicker({
                types: [
                    {
                        description: "Text files",
                        accept: {
                            "text/*": ".txt"
                        }
                    }
                ],
                multiple: false,
                excludeAcceptAllOption: true,
            });
            cfh = fh;
            return await fh.getFile()
        } catch (err) {
            console.error(err)
            if (!err.toString().includes("aborted")) alert("User must do an input (keypress/click) before opening dialog, or File API not supported.")
        }
    }

    e.addEventListener("scroll", (a) => {
        const st = a.target.scrollTop
        h.scrollTop = st
        l.scrollTop = st
        h.scrollLeft = a.target.scrollLeft
    })
    l.addEventListener("scroll", (a) => {
        const st = a.target.scrollTop
        h.scrollTop = st
        e.scrollTop = st
    })

    const ins = (ch, ev) => {
        const sp = e.selectionStart
        const ep = e.selectionEnd

        if (e.value.charAt(sp) == ch) {
            e.setSelectionRange(sp + 1, sp + 1)
            ev.preventDefault()
            return
        }

        e.value = e.value.substring(0, sp) + ch + e.value.substring(ep)
        e.selectionStart = e.selectionEnd = sp + ch.length - 1
        e.focus()
    }

    const inb = (ch, a) => {
        var sp = e.selectionStart;
        if (e.value.charAt(sp) != ch) return
        e.setSelectionRange(sp + 1, sp + 1);
        a.preventDefault()
    }

    const hl = () => {
        var rs;
        if (intSug) {
            rs = insertAt(e.value, "suggestion", e.selectionStart)
        }
        h.innerHTML = hljs.highlight(rs || e.value, { language: lang }).value || (rs || e.value)
    }

    const fd = () => {
        try {
            e.value = js_beautify(e.value, { indent_size: 4 })
            hl()
            cm.style.display = "none"
        } catch (err) {
            alert("Failed to format...")
            console.error(err)
        }
    }

    e.addEventListener("keydown", async (a) => {
        if (a.key == "Tab") a.preventDefault()
        hl()

        try {
            if (a.ctrlKey && a.key == "d" || a.metaKey && a.key == "d") {
                a.preventDefault();
                const ae = document.createElement("a")
                var fn = prompt("file name? (with ext.)")
                if (!fn) return
                ae.download = fn
                ae.href = URL.createObjectURL(new Blob([e.value], { type: 'text/plain' }))
                ae.click()
            }
            else if (a.ctrlKey && a.key == "s" || a.metaKey && a.key == "s") {
                a.preventDefault()
                if (cfh) {
                    console.log(cfh)
                    var w = await cfh.createWritable()
                    await w.write(new Blob([e.value], { type: 'text/plain' }))
                    await w.close()
                } else {
                    if (wl) wl.close()
                    const w = window.open()
                    w.document.write(e.value)
                    wl = w
                }
            }
            else if (a.ctrlKey && a.key == "p" || a.metaKey && a.key == "p") {
                a.preventDefault()
                fd()
            }
            else if (a.ctrlKey && a.key == "o" || a.metaKey && a.key == "o") {
                a.preventDefault()
                const f = await gf()
                if (!f) return
                lang = /(?:\.([^.]+))?$/.exec(f.name)[1];
                e.value = await f.text()
                setTimeout(hl);
            }
        } catch (err) { alert(err) }

        switch (a.key) {
            case "Tab":
                ins('    ')
                break
            case "{":
                ins("}", a)
                break
            case "[":
                ins("]", a)
                break
            case "(":
                ins(")", a)
                break
            case "\"":
                ins("\"", a)
                break
            case "\'":
                ins("\'", a)
                break
            case "\`":
                ins("\`", a)
            case ")":
                inb(")", a)
                break
            case "}":
                inb("}", a)
                break
            case "]":
                inb("]", a)
                break/*
            case "Backspace":
                console.log(e.value.charAt(e.selectionStart))
                if (e.value.charAt(e.selectionStart - 1) == "{") {
                    setTimeout(() => e.value = e.value.replaceAt(0, ""))
                }*/
        }
        setTimeout(() => {
            is(a.key)

            setTimeout(() => {

                hl()
                const st = e.scrollTop
                l.scrollTop = st
                h.scrollTop = st
                h.scrollLeft = e.scrollLeft

                let ld = ""
                let ln = e.value.split("\n").length
                for (let i = 0; i < ln; i++) { ld += `${i + 1}<br>` }
                l.innerHTML = ld
            })

        })
    })
    e.addEventListener("contextmenu", (ev) => {
        ev.preventDefault();
        cm.style.top = ev.clientY;
        cm.style.left = ev.clientX;
        cm.style.display = "flex"
    })
    e.addEventListener("click", (ev) => {
        cm.style.display = "none"
    })
    d(".fm").addEventListener("click", fd)
    String.prototype.replaceAt = function (index, replacement) {
        return this.substring(0, index) + replacement + this.substring(index + replacement.length);
    }
</script>
