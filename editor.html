data:text/html,
<title>Nimbus Web | v1.0.1</title>

<style>
    .l {
        position: fixed;
        left: 0;
        top: 0;
        width: 30px;
        height: 100%;
        background-color: rgb(40, 44, 52);
        color: white;
        text-align: center;
        font-size: 14px;
        padding-top: 5px;
        box-sizing: border-box;
        line-height: 1em;
        overflow-y: scroll;
        cursor: default;
        font-family: Menlo, Monaco, 'Courier New', monospace;
        border-right: 1px solid lightgray;
    }

    .l::-webkit-scrollbar {
        display: none;
    }


    .c {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        width: calc(100% - 30px);
        height: 100%;
        position: fixed;
        left: 30px;
        top: 0;
        outline: 0;
        font-size: 14px;
        padding-top: 2.5px;
        box-sizing: border-box;
        line-height: 1em;
        background-color: transparent;
        color: transparent;
        border: none;
        padding-left: 5px;
        z-index: 3;
        caret-color: lightgray;
    }

    .c::selection {
        background-color: rgb(211, 211, 211, 0.35);
    }

    .h {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        width: calc(100% - 30px);
        height: 100%;
        position: fixed;
        left: 30px;
        top: -0;
        outline: 0;
        font-size: 14px;
        padding-top: 2.5px;
        box-sizing: border-box;
        line-height: 1em;
        background-color: rgb(40, 44, 52);
        color: lightgray;
        border: none;
        padding-left: 5px;
        z-index: 2;
        overflow-y: scroll;
    }
    .cm {
        position: fixed;
        z-index: 4;
        background-color: black;
        color: white;
        top: 100px;
        left: 100px;
        width: 200px;
        height: 30px;
        display: flex;
        justify-content: center;
    }
    .cm > div {
        display: flex;
        cursor: pointer;
        text-decoration: center;
        align-items: center;
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/a-riceeater/DataCodeEditor@latest/atom.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify.js"></script>

<div class="l"></div>
<pre>
        <div class="h"></div>
    </pre>
<textarea class="c" autofocus spellcheck="false" autocomplete="off" autocapitalize="false"></textarea>
<div class="cm">
    <div class="fm">Format Document</div>
</div>
<!-- Intelliscense, won't include in main but different file? -->
<script>
    try {
        function is(k) {
            const st = setTimeout;
            var lc = e.value.charAt(e.selectionStart);
            switch (k) {
                case "Enter":
                    ins("     ")
                    break
            }
        }
    } catch (er) {
        alert(er)
    }
</script>
<script>
    var lang = prompt('What language are you coding in?').trim()
    var h = document.querySelector(".h")
    var e = document.querySelector(".c")
    var l = document.querySelector(".l")
    var wl

    navigator.platform.toString().toLowerCase().includes('mac') ? e.placeholder = 'META+S: OPEN PAGE OUTPUT | META+D: SAVE AS FILE' : e.placeholder = 'CTRL+S: OPEN PAGE OUTPUT | CTRL+D: SAVE AS FILE'

    e.addEventListener("scroll", (a) => {
        const st = a.target.scrollTop
        h.scrollTop = st
        l.scrollTop = st
        h.scrollLeft = a.target.scrollLeft
    })
    l.addEventListener("scroll", (a) => {
        const st = a.target.scrollTop
        h.scrollTop = st
        e.scrollTop = st
    })

    const ins = (ch, ev) => {
        const sp = e.selectionStart
        const ep = e.selectionEnd

        if (e.value.charAt(sp) == ch) {
            e.setSelectionRange(sp + 1, sp + 1)
            ev.preventDefault()
            return
        }

        e.value = e.value.substring(0, sp) + ch + e.value.substring(ep)
        e.selectionStart = e.selectionEnd = sp + ch.length - 1
        e.focus()
    }

    const inb = (ch, a) => {
        var sp = e.selectionStart;
        if (e.value.charAt(sp) != ch) return
        e.setSelectionRange(sp + 1, sp + 1);
        a.preventDefault()
    }

    e.addEventListener("keydown", (a) => {
        if (a.key == "Tab") a.preventDefault()

        try {
            if (a.ctrlKey && a.key == "d" || a.metaKey && a.key == "d") {
                a.preventDefault();
                const ae = document.createElement("a")
                var fn = prompt("file name? (with ext.)")
                if (!fn) return
                ae.download = fn
                ae.href = URL.createObjectURL(new Blob([e.value], { type: 'text/plain' }))
                ae.click()
            }
            else if (a.ctrlKey && a.key == "s" || a.metaKey && a.key == "s") {
                a.preventDefault()
                if (wl) wl.close()
                const w = window.open()
                w.document.write(e.value)
                wl = w
            }
        } catch (err) { alert(err) }

        switch (a.key) {
            case "Tab":
                ins('    ')
                break
            case "{":
                ins("}", a)
                break
            case "[":
                ins("]", a)
                break
            case "(":
                ins(")", a)
                break
            case "\"":
                ins("\"", a)
                break
            case "\'":
                ins("\'", a)
                break
            case "\`":
                ins("\`", a)
            case ")":
                inb(")", a)
                break
            case "}":
                inb("}", a)
                break
            case "]":
                inb("]", a)
                break
            case "~":
                // intelisense
                a.preventDefault();
                try {
                    e.value = js_beautify(e.value, { indent_size: 4 })
                } catch (err) {
                    alert("Failed to format...")
                    console.error(err)
                }

        }
        setTimeout(() => {
            var ta = a.target
            is(a.key)

            setTimeout(() => {
                h.innerHTML = hljs.highlight(ta.value, { language: lang }).value || ta.value
                const st = ta.scrollTop
                l.scrollTop = st
                h.scrollTop = st
                h.scrollLeft = ta.scrollLeft

                let ld = ""
                let ln = ta.value.split("\n").length
                for (let i = 0; i < ln; i++) { ld += `${i + 1}<br>` }
                l.innerHTML = ld
            })

        })
    })
</script>
